---
import ImageMod from '@/components/ImageMod.astro';

// Hero banner carousel component with 3 images

// Array of hero images
const heroImages = [
  { src: "/images/local-day.png", alt: "Mercado regional durante el día", title: "Mercado Regional", subtitle: "Variedad de productos regionales y artesanales" },
  { src: "/images/local-noon.png", alt: "Mercado regional al mediodía", title: "Contamos con Restaurante", subtitle: "Disfruta de deliciosos platillos tradicionales en nuestro espacio gastronómico" },
  { src: "/images/product.jpg", alt: "Productos regionales frescos", title: "Esta Navidad, Regala Amor", subtitle: "Encuentra el regalo perfecto con productos hechos con corazón" },
];
---

<section class="hero-banner w-full overflow-hidden relative">
  <div class="carousel-container flex transition-transform duration-500 ease-in-out overflow-hidden" id="hero-carousel">
    {heroImages.map((image, index) => (
      <div class="flex-shrink-0 w-full h-96 md:h-[500px] lg:h-[600px] relative">
        <ImageMod
          src={image.src}
          alt={image.alt}
          width={1200}
          height={400}
          class="w-full h-full object-cover"
          loading={index === 0 ? "eager" : "lazy"}
          fetchpriority={index === 0 ? "high" : "low"}
          aboveTheFold={index === 0}
        />
        <!-- Optional overlay for text -->
        <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center">
          <div class="text-center text-white">
            <h1 class="text-4xl md:text-6xl font-bold mb-4">
              {image.title}
            </h1>
            <p class="text-lg md:text-xl">
              {image.subtitle}
            </p>
          </div>
        </div>
      </div>
    ))}
  </div>

  <!-- Navigation dots -->
  <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2" id="hero-dots">
    {heroImages.map((_, index) => (
      <button
        class={`w-3 h-3 rounded-full transition-colors ${index === 0 ? 'bg-white' : 'bg-white bg-opacity-50'}`}
        data-slide={index}
        aria-label={`Ir a slide ${index + 1}`}
      ></button>
    ))}
  </div>

  <!-- Navigation arrows -->
  <button class="nav-arrow prev absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-opacity-75 transition-opacity" aria-label="Imagen anterior">
    ‹
  </button>
  <button class="nav-arrow next absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-opacity-75 transition-opacity" aria-label="Imagen siguiente">
    ›
  </button>
</section>

<script>
  // Hero banner carousel script
  function initHeroCarousel() {
    const carousel = document.getElementById("hero-carousel");
    const dots = document.querySelectorAll("#hero-dots button");
    const prevBtn = document.querySelector(".nav-arrow.prev");
    const nextBtn = document.querySelector(".nav-arrow.next");

    if (!carousel || !dots.length) return;

    let currentSlide = 0;
    const totalSlides = 3;
    let autoSlideInterval: ReturnType<typeof setInterval> | null = null;
    let isTransitioning = false;

    function updateDots() {
      dots.forEach((dot, index) => {
        dot.classList.toggle('bg-white', index === currentSlide);
        dot.classList.toggle('bg-opacity-50', index !== currentSlide);
      });
    }

    function goToSlide(slideIndex: number) {
      if (isTransitioning || slideIndex === currentSlide || !carousel) return;
      isTransitioning = true;

      currentSlide = slideIndex;
      const translateX = -currentSlide * 100;
      carousel.style.transform = `translateX(${translateX}%)`;

      updateDots();

      setTimeout(() => {
        isTransitioning = false;
      }, 500);
    }

    function nextSlide() {
      const next = (currentSlide + 1) % totalSlides;
      goToSlide(next);
    }

    function prevSlide() {
      const prev = (currentSlide - 1 + totalSlides) % totalSlides;
      goToSlide(prev);
    }

    function startAutoSlide() {
      autoSlideInterval = setInterval(nextSlide, 5000); // Change slide every 5 seconds
    }

    function stopAutoSlide() {
      if (autoSlideInterval) {
        clearInterval(autoSlideInterval);
        autoSlideInterval = null;
      }
    }

    // Event listeners
    prevBtn?.addEventListener("click", () => {
      stopAutoSlide();
      prevSlide();
      startAutoSlide();
    });

    nextBtn?.addEventListener("click", () => {
      stopAutoSlide();
      nextSlide();
      startAutoSlide();
    });

    dots.forEach((dot, index) => {
      dot.addEventListener("click", () => {
        stopAutoSlide();
        goToSlide(index);
        startAutoSlide();
      });
    });

    // Pause on hover
    const banner = document.querySelector(".hero-banner");
    banner?.addEventListener("mouseenter", stopAutoSlide);
    banner?.addEventListener("mouseleave", startAutoSlide);

    // Start auto slide
    startAutoSlide();
  }

  // Initialize on page load and after view transitions
  document.addEventListener("astro:page-load", initHeroCarousel);
</script>

<style>
  .hero-banner {
    position: relative;
  }

  .carousel-container {
    width: 300%; /* 3 slides */
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .hero-banner .nav-arrow {
      display: none; /* Hide arrows on mobile, use dots only */
    }
  }
</style>
